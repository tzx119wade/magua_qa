<!DOCTYPE html>
{% load staticfiles %}
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="{% static 'css/semantic.css' %}" media="screen" title="no title">
    <link rel="stylesheet" href="{% static 'css/detail.css' %}" media="screen" title="no title">
    <script src="{% static 'js/vue1.js' %}"></script>
    <script src="{% static 'js/js.cookie.js' %}"></script>
    <script src="{% static 'js/reqwest.js' %}"></script>
    <script src="{% static 'js/jquery.js' %}"></script>
    <script src="{% static 'js/semantic.js' %}"></script>
    <title>é—®é¢˜è¯¦æƒ…é¡µ</title>
    <style>
    [v-cloak] {
      display: none;
    }
    </style>
  </head>
  {% verbatim %}
  <body id="app" v-cloak>

    <!--èœå•å¼€å§‹-->
    <div id="global-nav" style="box-shadow: 2px 5px 5px #888888;">
      <div class="ui inverted fixed compact borderless menu" style="height:46px;">
        <a  class="item" href="http://127.0.0.1:8000/home" style="cursor=pointer;">
          <div class="ui image">
            <img src="http://127.0.0.1:8000/static/images/logo.png" alt="" />
          </div>
        </a>
        <div href="#" class="item">
          <div class="ui icon input">
            <input type="text" placeholder="æœç´¢ä½ æ„Ÿå…´è¶£çš„å†…å®¹...">
            <i class="search icon"></i>
          </div>
        </div>
        <a class="item">
          <img src="http://127.0.0.1:8000/static/images/question_icon.png" alt="" class="ui icon"/>
          <span>æé—®</span>
        </a>
        <a class="active item">
          <img src="http://127.0.0.1:8000/static/images/read_icon.png" alt="" class="ui icon"/>
          <span>é˜…è¯»</span>
        </a>
        <a class="item">
          <img src="http://127.0.0.1:8000/static/images/answer_icon.png" alt="" class="ui icon"/>
          <span>å›ç­”</span>
        </a>
        <div class="right menu">
          <div class="item">
            <img class="ui mini rounded icon" v-bind:src="userprofile.avatar" alt="" style="width:35px;height:35px;"/>
            <span>{{ userprofile.nickname }}</span>
          </div>
        </div>
      </div>
    </div>
    <!--èœå•ç»“æŸ-->
    <!--é—®é¢˜å¼€å§‹-->
    <div class="question">
      <div class="tag-label">
        <template v-for="tag in question.tags">
          <div class="ui circular label">{{ tag.name }}</div>
        </template>
      </div>
      <div class="ui header">
        <h3>{{ question.title }}</h3>
        <div class="sub header">
          <div class="sub header">
            {{ question.info }}
          </div>
        </div>
      </div>
      <div id="divider">
        <div class="ui divider"></div>
        <div class="ui header number">å…±{{ answers.length }}ä¸ªå›ç­”</div>
        <div class="ui divider"></div>
      </div>
    </div>
    <!--é—®é¢˜ç»“æŸ-->
    <!--æ­£æ–‡å¼€å§‹-->
    <template v-if="has_answers == true" v-for="answer in answers">
      <div class="item-answer">
        <div class="p-answer">
          <!-- å¦‚æœæŠ•è¿‡èµåŒç¥¨ -->
          <button class="ui icon button up" type="button" name="button" style="background:#2d84cc;" v-if="answer.choose == 'like'" v-on:click="request_vote_api(answer.answer_id,'like',$index)">
            <img src="http://127.0.0.1:8000/static//images/upvote_icon.png" alt=""/>
            <div class="number" style="color:white;">{{ answer.voters_count }}</div>
          </button>
          <!-- å¦‚æœæ²¡æœ‰æŠ•è¿‡èµåŒç¥¨ -->
          <button class="ui icon button up" type="button" name="button" style="background:#eef3f7;" v-else v-on:click="request_vote_api(answer.answer_id,'like',$index)">
            <img src="http://127.0.0.1:8000/static//images/upvote_icon.png" alt="" />
            <div class="number">{{ answer.voters_count }}</div>
          </button>
          <!-- å¦‚æœæŠ•è¿‡åå¯¹ç¥¨ -->
          <button class="ui icon button down" type="button" name="button" style="background:#2d84cc;" v-if="answer.choose == 'unlike'" v-on:click="request_vote_api(answer.answer_id,'unlike',$index)">
            <img src="http://127.0.0.1:8000/static//images/downvote_icon.png" alt="" />
          </button>
          <!-- å¦‚æœæ²¡æœ‰æŠ•è¿‡åå¯¹ç¥¨ -->
          <button class="ui icon button down" type="button" name="button" style="background:#eef3f7;" v-else v-on:click="request_vote_api(answer.answer_id,'unlike',$index)">
            <img src="http://127.0.0.1:8000/static//images/downvote_icon.png" alt="" />
          </button>
        </div>
        <div class="c-answer">
          <div class="ui text menu">
            <div class="ui header">
              {{ answer.nickname }},<span> {{ answer.signature }}</span>

              <!-- ç‚¹èµç­‰äº0çš„æƒ…å†µ-->
              <div class="sub header" v-if="answer.voters_count == 0">
                å¦‚æœå›ç­”ä¸é”™ï¼Œå°±ç»™ç­”ä¸»ç‚¹ä¸ªèµğŸ‘å§
              </div>
              <!-- voter >0 && <=5-->
              <div class="sub header" v-if="answer.voters_count > 0 && answer.voters_count <=5">
                <template v-for="name in answer.voters">
                  <template v-if="$index != answer.voters.length -1">
                    {{ name }},
                  </template>
                  <template v-else>
                    {{ name }}
                  </template>
                </template>
                åˆšåˆšç‚¹äº†èµåŒ
              </div>
              <!-- count > 5çš„æ—¶å€™-->
              <div class="sub header" v-if="answer.voters_count > 5">
                <template v-for="name in answer.voters">
                  <template v-if="$index != answer.voters.length - 1">
                    {{ name }},
                  </template>
                  <template v-else>
                    {{ name }}
                  </template>
                </template>
                ...å…±{{ answer.voters_count }}äººç‚¹äº†èµåŒğŸ‘
              </div>

            </div>
            <div class="ui image user-icon">
              <img alt="" v-bind:src="answer.avatar" style="width:38px;height:38px;"/>
            </div>
          </div>
          <div class="r-answer">
            <template v-for="line in answer.content.split('\n')">
              <p>{{ line }}</p></br>
            </template>
          </div>
          <div class="ui text menu meta-item">
            <div class="item">
              å‘å¸ƒäº{{ answer.created_date }}
            </div>
            <div class="item">
              <div class="ui image">
                <img src="http://127.0.0.1:8000/static//images/comment_icon.png" alt="" />
              </div>
              å…±{{ answer.comments_count }}æ¡è¯„è®º
            </div>
          </div>
          <div class="ui divider"></div>
        </div>
      </div>

      <!--<div class="item-answer">
        <div class="p-answer">
          <button class="ui icon button up" type="button" name="button">
            <img src="http://127.0.0.1:8000/static//images/upvote_icon.png" alt="" />
            <div class="number">62</div>
          </button>
          <button class="ui icon button down" type="button" name="button">
            <img src="http://127.0.0.1:8000/static//images/downvote_icon.png" alt="" />
          </button>
        </div>
        <div class="c-answer">
          <div class="ui text menu">
            <div class="ui header">
              ç¿æ·¼é’,<span> duilibä½œè€…</span>
              <div class="sub header">
                æ¨å¤§ç¥ã€å¿«åˆ€æ­¦å£«ã€è´ºè€å¸ˆã€è‘›è´¨é‡ã€phodalç­‰62äººèµåŒ
              </div>
            </div>
            <div class="ui image user-icon">
              <img src="http://127.0.0.1:8000/static/images/avatar_4.png" alt="" />
            </div>
          </div>
          <div class="r-answer">
            <p>
              åšç€è„¸çš®å ä¸ªå‘ <br>
              duilib:<a href="#">GitHub - duilib/duilib</a><br>
              ç›®å‰star 900+ï¼Œè¿˜ä¸è¾¾æ ‡ï¼Œä¸è¿‡è€ƒè™‘åˆ°æ—©æœŸå¼€æºåœ¨google codeä»¥åŠä¸€äº›è¡ç”Ÿé¡¹ç›®ï¼Œåº”è¯¥æ˜¯æœ‰1000+çš„ã€‚
            </p>
            <p>
              ä½œç”¨ï¼š
              duilibæ˜¯åŸºäºå¸ƒå±€å’Œç»„åˆç†å¿µè€Œè®¾è®¡çš„ä¸€ä¸ªwindowsä¸‹guiåº“ï¼Œä»£ç ç®€æ´é«˜æ•ˆç¨³å®šã€‚
            </p>
            <p>å€¼å¾—ä¸€æçš„äº‹ï¼š <br>
              åšduilibä¹‹å‰ï¼Œæˆ‘å¯¹ç•Œé¢å¼€å‘ä¹Ÿæ˜¯ä¸ªæ–°æ‰‹ï¼Œè™½ç„¶æœ‰å¤šå¹´çš„ç¼–ç¨‹ç»éªŒï¼Œä½†åŸºæœ¬æ²¡å†™è¿‡ç•Œé¢ä»£ç ã€‚åŸºäºvikseoçš„å¼€æºé¡¹ç›®å¤§å¹…é‡æ„åå‘å¸ƒäº†duilibç¬¬ä¸€ç‰ˆï¼Œæ€€ç€å¿å¿‘çš„å¿ƒæƒ…å‘åˆ°csdnè®ºå›ä¸Šï¼Œå±…ç„¶æœ‰å‡ ä¸ªä¸è®¤è¯†çš„ç½‘å‹åœ¨å¸®å¿™å®£ä¼ æ¨å¹¿å’Œç»´æŠ¤ï¼Œæœ€æ—©æ˜¯è¸é›ªæµäº‘ï¼Œåæ¥åˆæ¥äº†tojenå’Œdaviyangç­‰å‡ ä¸ªæ–°æœ‹å‹ï¼Œå¤§å®¶çƒ­å¿ƒçš„æäº¤patchã€ç¼–å†™demoã€çŒ®è¨€çŒ®ç­–ï¼Œæœ¬äººå†…å¿ƒå—åˆ°å¾ˆå¤§çš„é¼“èˆï¼Œå°±æ­£å¼æŠŠduilibä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®æ¥åšã€‚åˆ°ä»Šå¹´8æœˆä»½duilibä¹Ÿå·®ä¸å¤š6å‘¨å¹´äº†ï¼Œè™½ç„¶ä½œä¸ºä¸€ä¸ªä¼ ç»Ÿçš„pcé¡¹ç›®ï¼Œä»–å·²ç»ä¸é‚£ä¹ˆé…·äº†ï¼Œä½†ä½œä¸ºä¸€ä¸ªå¹¿æ³›åº”ç”¨çš„uiåº“ï¼Œæˆ‘ä¸ªäººä¼šä¸€ç›´ç»´æŠ¤ä¸‹å»çš„ã€‚ä»é•¿è¿œçœ‹ä¸­å°å›¢é˜Ÿå¼€å‘çš„é€šç”¨uié¡¹ç›®å·²ç»å¾ˆéš¾å’Œblink/webkitè¿™ç±»å¤§å‹é¡¹ç›®ç«äº‰äº†ï¼Œhtml5+æ¡Œé¢å¼€å‘å¹³å°ä¼šè¶Šæ¥è¶Šæµè¡Œï¼ˆæ¯”å¦‚æ¥¼ä¸Šçš„electronå’Œnwjsï¼‰ï¼Œä½†duilibè¿˜ç»§ç»­ä¼šåœ¨å¯¹å¤§å°å’Œæ€§èƒ½æœ‰è¦æ±‚çš„å®¢æˆ·ç«¯äº§å“ä¸Šç»§ç»­å ä¸€å¸­ä¹‹åœ°ï¼Œå¹¶è°‹æ±‚è·¨å¹³å°è·¨ç»ˆç«¯çš„å‘å±•ã€‚
            </p>
            <p>
              å¥‡è‘©çš„äº‹:<br>
              å¾ˆæ—©ä»¥å‰ï¼Œæœ‰ä¸ªç æµ·çš„ç¨‹åºå‘˜ç»™duilibåšäº†ä¸ªè®ºå›ï¼Œåæ¥å°±å®£ç§°è‡ªå·±æ˜¯duilibçš„å¼€å‘è€…å’Œç®¡ç†è€…ï¼Œè¢«è´¨ç–‘å°±åˆ°å¤„è¯´ä»–ä»duilibå¼€å‘å›¢é˜Ÿåˆ†è£‚ï¼Œè¦å»åšä¸€ä¸ªç‰›é€¼çš„html5æ¡Œé¢å¼€å‘æ¡†æ¶ã€‚å®é™…ä¸Šï¼Œduilibä¸€ç›´æ‰˜ç®¡åœ¨google codeï¼ˆæ—©æœŸï¼‰å’Œgithubï¼ˆç›®å‰ï¼‰ä¸Šï¼Œè°æœ‰æäº¤ä¸€æ¸…äºŒæ¥šï¼Œæ­¤å›æ²¡æœ‰æäº¤æƒé™ä¹Ÿæ²¡æœ‰æäº¤è¿‡ä¸€è¡Œä»£ç ç”šè‡³ä¸€ä¸ªbugå‘¢ã€‚
            </p>
            <p>
              å¯¹ç”Ÿæ´»çš„å½±å“ï¼š<br>
              10ã€11å¹´çš„æ—¶å€™æœ‰è¿‡å¤šæ¬¡åŠå¤œè°ƒè¯•çš„ç»å†ï¼Œåæ¥åŸºæœ¬æ²¡æœ‰äº†ï¼Œå¶å°”å’Œæœ‹å‹æˆ–åŒäº‹èŠå¤©ï¼Œèƒ½çœ‹åˆ°å¯¹æ–¹ä¸€è„¸æƒŠè®¶çš„è¡¨ç¤ºï¼ŒduilibåŸæ¥æ˜¯ä½ å†™çš„ï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­ç”¨è¿‡æˆ–æ­£åœ¨ç”¨å‘¢ï¼Œç„¶åå†…å¿ƒå°å¾—æ„ä¸€ä¸‹ã€‚
            </p>
          </div>
          <div class="ui text menu meta-item">
            <div class="item">
              å‘å¸ƒäº2016-05-24
            </div>
            <div class="item">
              <div class="ui image">
                <img src="http://127.0.0.1:8000/static//images/comment_icon.png" alt="" />
              </div>
              æ”¶èµ·è¯„è®º
            </div>
          </div>

          <div class="ex-comment">
            <div class="ui basic center aligned segment upangle">
              <i class="icon up large angle" style=""></i>
            </div>
            <div class="ui segment" style="overflow:auto;margin-top:0;position:relative;">
              <div class="ui comments">
                <div class="comment">
                  <a class="avatar">
                    <img src="http://127.0.0.1:8000/static//images/avatar_1.png" alt="" />
                  </a>
                  <div class="content">
                    <a class="author">éŸ¦æ˜“ç¬‘</a>
                    <div class="text">æŒºå¥½ä¸€ä¸ªåº“ï¼Œå¯æƒœé”™è¿‡äº†ç•Œé¢è„šæœ¬åŒ–çš„å¤§æ½®,cefï¼Œpyqtï¼Œqt+jsï¼Œelectronï¼Œéƒ½å¯ä»¥ç”¨å„ç§å„æ ·çš„åŠ¨æ€è¯­è¨€è¿›è¡Œå¼€å‘ï¼Œæ•ˆç‡æ˜¯æ¯”ä¼ ç»ŸC++å¿«ä¸‰å€ä»¥ä¸Šã€‚</div>
                    <div class="actions">
                      <span class="date" style="color: grey;">5æœˆå‰</span>
                      <i class="icon reply grey"></i>
                      <a class="reply">å›å¤</a>
                    </div>
                  </div>
                </div>
                <div class="ui divider"></div>
                <div class="comment">
                  <a class="avatar">
                    <img src="http://127.0.0.1:8000/static//images/avatar_2.png">
                  </a>
                  <div class="content">
                    <a class="author">åˆ˜äºŒ</a>
                    <div class="text">è€å®è¯´å†™çš„ä¸å¥½ï¼Œç”¨ç€åˆ«æ‰­çš„åœ°æ–¹ä¸å°‘ï¼Œæœ‰ä¸ªå«duivisionæ¯”ä½ çš„å¼ºå¤šäº†ï¼Œä¹Ÿè°¦è™šå¤šäº†ï¼</div>
                    <div class="actions">
                      <span class="date" style="color: grey;">5æœˆå‰</span>
                    </div>
                  </div>
                </div>
                <div class="ui divider"></div>
                <div class="comment">
                  <a class="avatar">
                    <img src="http://127.0.0.1:8000/static//images/avatar_2.png">
                  </a>
                  <div class="content">
                    <a class="author">éŸ©æ°‘æ”¿</a>
                    <span style="color: grey;">å›å¤</span>
                    <a class="author">åˆ˜äºŒ</a>
                    <div class="text">å“ªå„¿çœ‹å‡ºä½œè€…ä¸è°¦è™šäº†ã€‚</div>
                    <div class="actions">
                      <span class="date" style="color: grey;">5æœˆå‰</span>
                    </div>
                  </div>
                </div>
                <form class="ui reply form">
                  <div class="ui input" style="width:100%;">
                    <input type="text" >
                  </div>
                  <button class="ui button" style="float: right;color:#fff;background-color:#3e78ad;margin-top:14px;">è¯„è®º</button>
                  <button class="ui button" style="float: right;background-color:#ffffff;margin-top:14px;">å–æ¶ˆ</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>-->
    </template>

    <!-- reply æ§ä»¶ -->
    <div class="reply-input">
      <div class="ui text menu">
        <div class="header item">
          <a>{{ userprofile.nickname }}</a><span>,æ·»åŠ ä½ çš„å›ç­”</span>
        </div>
        <div class="right menu">
          <div class="ui image">
            <img v-bind:src="userprofile.avatar" alt="" style="width:26px;height:26px;"/>
          </div>
        </div>
      </div>
      <div class="ui card" style="width:100%;">
        <div class="image" style="height: 38px;">
          <i class="icon picture grey large"></i>
          <i class="icon code large"></i>
        </div>
        <div class="content" style="padding:0;">
          <textarea style="" placeholder=" å†™å›ç­”..."></textarea>
        </div>
      </div>
      <button class="ui button">å‘å¸ƒå›ç­”</button>
    </div>
    <!--æ­£æ–‡ç»“æŸ-->
    <!--é¡µè„š-->
    <div class="zh-footer">
        <div class="ui divider"></div>
        <span class="f-left">Developed by Mugglecoding team xxx</span>
        <span class="f-middle">
          <a href="#" target="_blank">å…³äºæˆ‘ä»¬ .</a>
          <a href="#" target="_blank">åŠ å…¥æˆ‘ä»¬ .</a>
          <a href="#" target="_blank">è”ç³»æˆ‘ä»¬</a>
        </span>

        <span class="f-right">äº¬ICPå¤‡15047012å·-2 </span>
    </div>
    <!-- vue è„šæœ¬ -->
  <script>
    // string format
    String.prototype.format = function () {
      var i = 0, args = arguments;
      return this.replace(/{}/g, function () {
        return typeof args[i] != 'undefined' ? args[i++] : '';
      });
    };

      var app = new Vue({
        el : '#app',
        data : {
          question : {},
          userprofile : {},
          has_answers : false,
          answers : [],
        },
        methods : {
          get_userprofile : function(){
            var self = this;
            reqwest({
              url : 'http://127.0.0.1:8000/api/userprofile',
              method : 'get',
              type : 'json',
              headers:Cookies.get('token')? {'Authorization': 'Token ' + Cookies.get('token')}:{},
              success : function(resp){
                console.log('userprofile is ok !');
                self.userprofile = resp;
              },
              error : function(error){
                console.log('userprofile not work !');
                console.log(error);
              }
            });
          },
          get_keyword : function(name){
            if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
            return decodeURIComponent(name[1]);
          },
          get_question : function(){
            var self = this;
            var question_id = self.get_keyword('id');
            var url = 'http://127.0.0.1:8000/api/question/{}'.format(String(question_id))
            reqwest({
              url : url,
              method : 'get',
              type : 'json',
              headers:Cookies.get('token')? {'Authorization': 'Token ' + Cookies.get('token')}:{},
              success : function(resp){
                console.log('get question ok !');
                self.question = resp;
              },
              error : function(error){
                console.log('get question wrong !');
              }
            });
          },
          // get answers
          get_answers : function(){
            var self = this;
            var qid = self.get_keyword('id');
            var url = 'http://127.0.0.1:8000/api/answer/{}'.format(String(qid));
            // è¯·æ±‚æ¥å£
            reqwest({
              url : url,
              method : 'get',
              type : 'json',
              headers:Cookies.get('token')? {'Authorization': 'Token ' + Cookies.get('token')}:{},
              success : function(resp){
                console.log('get answer is ok!');
                if (resp.count == 1) {
                  self.answers.push(resp.data);
                }else if (resp.count > 1) {
                  self.answers = resp.data;
                }
                self.has_answers = true;
              },
              error : function(error){
                console.log('get answer wrong !');
                console.log(error);
                if (error.status == 404) {
                  console.log('status is 404');
                }
                self.has_answers = false;
              }
            });
          },
          // request voter api
          request_vote_api : function(id,choose,a_index){

            var self = this;
            reqwest({
              url : 'http://127.0.0.1:8000/api/vote',
              method : 'post',
              type : 'json',
              data : {
                answer_id:id,
                choose : choose,
              },
              headers:Cookies.get('token')? {'Authorization': 'Token ' + Cookies.get('token')}:{},
              success : function(resp){
                console.log('request vote api ok !');
                var nickname = resp.data.belong_to_userprofile.nickname;
                if (self.answers[a_index].choose == 'like' && resp.data.choose != 'like') {
                  // å‡å‡ºæ¥
                  self.answers[a_index].voters_count -= 1;
                  // éå†æ•°ç»„å¾—åˆ°è¦åˆ é™¤çš„å¯¹è±¡ä¸‹æ ‡
                  var index = 0;
                  for (var i = 0; i < self.answers[a_index].voters.length; i++) {
                    if (self.answers[a_index].voters[i] == nickname) {
                      index = i ;
                    }
                  }
                  self.answers[a_index].voters.splice(index,1);
                }else if (self.answers[a_index].choose != 'like' && resp.data.choose == 'like') {
                  // åŠ è¿›å»
                  self.answers[a_index].voters_count += 1;
                  self.answers[a_index].voters.unshift(nickname);
                }
                self.answers[a_index].choose = resp.data.choose;
              },
              error : function(error){
                console.log('request vote api wrong !');
              }
            });
          },

        },
        ready : function(){
          this.get_question();
          this.get_userprofile();
          this.get_answers();
        }
      })
    </script>
    </body>
    {% endverbatim %}
</html>
